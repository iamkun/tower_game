!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s=3)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moveDownMovement=t.tutorialMovement=t.lightningMovement=t.hookUpMovement=t.hookDownMovement=t.bgInitMovement=t.initialAngle=t.out=t.land=t.drop=t.beforeDrop=t.swing=t.rotateLeft=t.rotateRight=t.flightLayer=t.flightCount=t.ropeHeight=t.cloudSize=t.blockHeight=t.blockWidth=t.blockCount=t.bgLinearGradientOffset=t.lineInitialOffset=t.bgImgOffset=t.hookNormal=t.hookUp=t.hookDown=t.gameScore=t.perfectCount=t.failedCount=t.successCount=t.hardMode=t.gameUserOption=t.gameStartNow=void 0,t.gameStartNow="GAME_START_NOW",t.gameUserOption="GAME_USER_OPTION",t.hardMode="HARD_MODE",t.successCount="SUCCESS_COUNT",t.failedCount="FAILED_COUNT",t.perfectCount="PERFECT_COUNT",t.gameScore="GAME_SCORE",t.hookDown="HOOK_DOWN",t.hookUp="HOOK_UP",t.hookNormal="HOOK_NORMAL",t.bgImgOffset="BACKGROUND_IMG_OFFSET_HEIGHT",t.lineInitialOffset="LINE_INITIAL_OFFSET",t.bgLinearGradientOffset="BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",t.blockCount="BLOCK_COUNT",t.blockWidth="BLOCK_WIDTH",t.blockHeight="BLOCK_HEIGHT",t.cloudSize="CLOUD_SIZE",t.ropeHeight="ROPE_HEIGHT",t.flightCount="FLIGHT_COUNT",t.flightLayer="FLIGHT_LAYER",t.rotateRight="ROTATE_RIGHT",t.rotateLeft="ROTATE_LEFT",t.swing="SWING",t.beforeDrop="BEFORE_DROP",t.drop="DROP",t.land="LAND",t.out="OUT",t.initialAngle="INITIAL_ANGLE",t.bgInitMovement="BG_INIT_MOVEMENT",t.hookDownMovement="HOOK_DOWN_MOVEMENT",t.hookUpMovement="HOOK_UP_MOVEMENT",t.lightningMovement="LIGHTNING_MOVEMENT",t.tutorialMovement="TUTORIAL_MOVEMENT",t.moveDownMovement="MOVE_DOWN_MOVEMENT"},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.drawYellowString=t.addScore=t.addFailedCount=t.addSuccessCount=t.touchEventHandler=t.getHookStatus=t.getLandBlockVelocity=t.getSwingBlockVelocity=t.getAngleBase=t.getMoveDownValue=t.checkMoveDown=void 0;const s=a(i(0));t.checkMoveDown=e=>e.checkTimeMovement(s.moveDownMovement);t.getMoveDownValue=(e,t)=>{const i=t?t.pixelsPerFrame:e.pixelsPerFrame.bind(e),n=e.getVariable(s.successCount),r=2*e.getVariable(s.blockHeight);return i(n<=4?1.25*r:r)};t.getAngleBase=e=>{const t=e.getVariable(s.successCount),i=e.getVariable(s.gameScore),{hookAngle:n}=e.getVariable(s.gameUserOption);if(n)return n(t,i);if(e.getVariable(s.hardMode))return 90;switch(!0){case t<10:return 30;case t<20:return 60;default:return 80}};t.getSwingBlockVelocity=(e,t)=>{const i=e.getVariable(s.successCount),n=e.getVariable(s.gameScore),{hookSpeed:r}=e.getVariable(s.gameUserOption);if(r)return r(i,n);let o;switch(!0){case i<1:o=0;break;case i<10:o=1;break;case i<20:o=.8;break;case i<30:o=.7;break;default:o=.74}return e.getVariable(s.hardMode)&&(o=1.1),Math.sin(t/(200/o))};t.getLandBlockVelocity=(e,t)=>{const i=e.getVariable(s.successCount),n=e.getVariable(s.gameScore),{landBlockSpeed:r}=e.getVariable(s.gameUserOption);if(r)return r(i,n);const{width:o}=e;let a;switch(!0){case i<5:a=0;break;case i<13:a=.001;break;case i<23:a=.002;break;default:a=.003}return Math.cos(t/200)*a*o};t.getHookStatus=e=>e.checkTimeMovement(s.hookDownMovement)?s.hookDown:e.checkTimeMovement(s.hookUpMovement)?s.hookUp:s.hookNormal;t.touchEventHandler=e=>{if(!e.getVariable(s.gameStartNow))return;if(e.debug&&e.paused)return;if((0,t.getHookStatus)(e)!==s.hookNormal)return;e.removeInstance("tutorial"),e.removeInstance("tutorial-arrow");const i=e.getInstance("block_"+e.getVariable(s.blockCount));i&&i.status===s.swing&&(e.setTimeMovement(s.hookUpMovement,500),i.status=s.beforeDrop)};t.addSuccessCount=e=>{const{setGameSuccess:t}=e.getVariable(s.gameUserOption),i=e.getVariable(s.successCount)+1;e.setVariable(s.successCount,i),e.getVariable(s.hardMode)&&e.setVariable(s.ropeHeight,e.height*e.utils.random(.35,.55)),t&&t(i)};t.addFailedCount=e=>{const{setGameFailed:t}=e.getVariable(s.gameUserOption),i=e.getVariable(s.failedCount)+1;e.setVariable(s.failedCount,i),e.setVariable(s.perfectCount,0),t&&t(i),i>=3&&(e.pauseAudio("bgm"),e.playAudio("game-over"),e.setVariable(s.gameStartNow,!1))};t.addScore=(e,t)=>{const{setGameScore:i,successScore:n,perfectScore:r}=e.getVariable(s.gameUserOption),o=e.getVariable(s.perfectCount,0),a=t?o+1:0,c=e.getVariable(s.gameScore)+(n||25)+(r||25)*a;e.setVariable(s.gameScore,c),e.setVariable(s.perfectCount,a),i&&i(c)};t.drawYellowString=(e,t)=>{const{string:i,size:n,x:r,y:o,textAlign:a,fontName:s="wenxue",fontWeight:c="normal"}=t,{ctx:l}=e,u=n,h=.1*u;l.save(),l.beginPath();const d=l.createLinearGradient(0,0,0,o);d.addColorStop(0,"#FAD961"),d.addColorStop(1,"#F76B1C"),l.fillStyle=d,l.lineWidth=h,l.strokeStyle="#FFF",l.textAlign=a||"center",l.font=`${c} ${u}px ${s}`,l.strokeText(i,r,o),l.fillText(i,r,o),l.restore()}},function(e,t,i){"use strict";i.r(t),i.d(t,"Engine",(function(){return m})),i.d(t,"Instance",(function(){return b}));var n={};i.r(n),i.d(n,"getCurrentTime",(function(){return r})),i.d(n,"random",(function(){return o})),i.d(n,"randomPositiveNegative",(function(){return a})),i.d(n,"isFunction",(function(){return s})),i.d(n,"isTouchDevice",(function(){return c})),i.d(n,"requestAnimationFrameTool",(function(){return l})),i.d(n,"arraySwap",(function(){return u}));const r=()=>performance.now(),o=(e,t)=>Math.random()*(t-e)+e,a=()=>Math.random()<.5?-1:1,s=e=>"function"==typeof e,c=()=>"ontouchstart"in window||window.navigator.msMaxTouchPoints,l=(()=>{let e=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(t=>{window.setTimeout(()=>{const i=r();t(i);const n=r();e=1e3/60-(n-i)},e)})})(),u=(e,t,i)=>{const n=e[i];e[i]=e[t],e[t]=n};var h={linear:function(e,t,i,n){return i*e/n+t},easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}};const{requestAnimationFrameTool:d,isFunction:g,isTouchDevice:f}=n;class m{constructor(e={}){if(!document.createElement("canvas").getContext)return void window.alert("HTML5 Canvas is not supported in your browser.");const{canvasId:t,debug:i,width:r,height:o,highResolution:a,loadLimit:s,soundOn:c}=e;let l=r||window.innerWidth,u=o||window.innerHeight;this.canvas=document.getElementById(t),a&&(this.canvas.style.width=l+"px",this.canvas.style.height=u+"px",l*=2,u*=2),this.highResolution=a,this.canvas.width=l,this.canvas.height=u,this.width=this.canvas.width,this.height=this.canvas.height,this.calWidth=.5*this.width,this.calHeight=.5*this.height,this.debug=!!i,this.ctx=this.canvas.getContext("2d"),this.defaultLayer="default",this.layerArr=[this.defaultLayer],this.instancesObj={},this.instancesObj[this.defaultLayer]=[],this.instancesReactionArr=[],this.utils=n,this.customVariable={};const h=this;this.isTouchDevice=f(),this.debugArr=[],this.assetsObj={image:{},audio:{}},this.assetsCount={image:0,audio:0},this.assetsErrorQueue=[],this.assetsErrorCount=0,this.loadLimit=s||3,this.soundOn=!!c,this.fps=0,this.lastTime=0,this.lastPausedAt=0,this.pausedTime=0,this.paused=!1,this.timeMovement={},this.timeMovementStartArr=[],this.timeMovementFinishArr=[],this.keyUpListeners={},this.keyDownListeners={},this.keyPressListeners={},this.startAnimate=()=>{},this.paintUnderInstance=()=>{},this.paintAboveInstance=()=>{},this.endAnimate=()=>{},this.touchStartListener=()=>{},this.touchEndListener=()=>{},this.touchMoveListener=()=>{},document.addEventListener("keyup",e=>{h.keyListener(e,"keyup")},!1),document.addEventListener("keydown",e=>{h.keyListener(e,"keydown")},!1),document.addEventListener("keypress",e=>{h.keyListener(e,"keypress")},!1),this.isTouchDevice?(document.addEventListener("touchstart",e=>{h.touchStartListener(e)},!1),document.addEventListener("touchend",e=>{h.touchEndListener(e)},!1),document.addEventListener("touchmove",e=>{h.touchMoveListener(e)},!1)):(document.addEventListener("mousedown",e=>{h.touchStartListener(e)},!1),document.addEventListener("mouseup",e=>{h.touchEndListener(e)},!1),document.addEventListener("mousemove",e=>{h.touchMoveListener(e)},!1))}triggerReaction(e,t){let i=e,n=t;this.highResolution&&(i*=2,n*=2),this.instancesReactionArr.forEach(e=>{e.visible&&i>=e.x&&i<=e.x+e.width&&n>=e.y&&n<=e.y+e.height&&e.trigger(e,this)})}addAudio(e,t,i=0){if(!this.soundOn)return;i||(this.assetsCount.audio+=1);const n=new window.Audio;n.src=t,this.assetsObj.audio[e]=n,n.addEventListener("error",()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"audio"})},!1),n.load()}getAudio(e){return this.assetsObj.audio[e]}playAudio(e,t=!1){if(!this.soundOn)return;const i=this.getAudio(e);if(i){if(i.play(),!t)return;i.addEventListener("ended",()=>{i.currentTime=0,i.play()},!1)}}pauseAudio(e){const t=this.getAudio(e);t&&t.pause()}setVariable(e,t){this.customVariable[e]=t}getVariable(e,t=null){const i=this.customVariable[e];return i||(null!==t?(this.setVariable(e,t),t):null)}addImg(e,t,i=0){i||(this.assetsCount.image+=1);const n=new window.Image;n.src=t,n.onload=()=>{this.assetsObj.image[e]=n},n.onerror=()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"image"})}}getImg(e){return this.assetsObj.image[e]}animate(e){const t=e-this.pausedTime,i=this;this.paused?setTimeout(()=>{this.animate.call(i,t)},100):(this.tick(t),this.clean(),this.startAnimate(this,t),this.paintUnderInstance(this),this.updateInstances(t),this.paintInstances(),this.paintAboveInstance(),this.endAnimate(this,t),this.tickTimeMovement(),this.debug&&this.showFps(),this.debug&&this.drawDebug(),d(e=>{this.animate.call(i,e)}))}showFps(){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font=(this.highResolution?32:16)+"px Arial",this.ctx.fillText("FPS: "+this.fps.toFixed(),5,this.highResolution?40:20),this.ctx.restore()}debugLineX(e){this.debugArr.push({type:"lineX",y:e})}debugLineY(e){this.debugArr.push({type:"lineY",x:e})}debugDot(e,t){this.debugArr.push({type:"dot",x:e,y:t})}drawDebug(){this.debugArr.forEach(e=>{const{type:t,x:i,y:n}=e;switch(t){case"dot":this.drawDebugDot(i,n);break;case"lineX":this.drawDebugLine(null,n);break;case"lineY":this.drawDebugLine(i,null)}}),this.instancesReactionArr.forEach(e=>{e.visible&&(this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.stroke())})}drawDebugLine(e,t){let i=[0,t],n=[this.width,t];e&&(i=[e,0],n=[e,this.height]),this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.moveTo(...i),this.ctx.lineTo(...n),this.ctx.stroke(),this.ctx.restore()}drawDebugDot(e,t){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(e,t,2,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(e,t,1,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.restore()}tick(e){this.updateFps(e),this.lastTime=e}updateFps(e){0===this.lastTime?this.fps=60:this.fps=1e3/(e-this.lastTime)}pixelsPerFrame(e){return e/this.fps}tickTimeMovement(){this.timeMovementStartArr.forEach(e=>{this.timeMovement[e].processing=!0}),this.timeMovementStartArr=[],this.timeMovementFinishArr.forEach(e=>{delete this.timeMovement[e]}),this.timeMovementFinishArr=[]}getTimeMovement(e,t,i,n={}){const{before:r,after:o}=n,a=h[n.easing||"linear"],s=n.name||"default",c=this.timeMovement[e];if(!c)return;c.processing||(this.timeMovementStartArr.push(e),c.store[s]=[],t.forEach(e=>{c.store[s].push({start:parseFloat(e[0]),end:parseFloat(e[1])})}),r&&r());const l=(e=!1)=>{const{duration:t}=c;let n=t;if(!e){const e=this.utils.getCurrentTime(),{startTime:t}=c;n=e-t}const r=c.store[s].map(e=>a(n,e.start,e.end-e.start,t));i.apply(this,r)};this.checkTimeMovement(e)?l():(this.timeMovementFinishArr.push(e),l(!0),o&&o())}checkTimeMovement(e){const t=this.timeMovement[e]||{};return this.utils.getCurrentTime()<=t.endTime}setTimeMovement(e,t){const i=this.utils.getCurrentTime();this.timeMovement[e]={startTime:i,endTime:i+t,duration:t,store:{}}}clean(){this.ctx.clearRect(0,0,this.width,this.height),this.debugArr=[]}addLayer(e){this.layerArr.push(e),this.instancesObj[e]=[]}removeLayer(e){this.layerArr=this.layerArr.filter(t=>t!==e),delete this.instancesObj[e]}swapLayer(e,t){this.utils.arraySwap(this.layerArr,e,t)}addInstance(e,t=this.defaultLayer){this.instancesObj[t].push(e),e.trigger&&this.instancesReactionArr.push(e)}getInstance(e,t=this.defaultLayer){return this.instancesObj[t].filter(t=>t.name===e)[0]}removeInstance(e,t=this.defaultLayer){const i=this.getInstance(e,t);i&&(this.instancesObj[t]=this.instancesObj[t].filter(t=>t.name!==e),i.trigger&&(this.instancesReactionArr=this.instancesReactionArr.filter(t=>t.name!==e)))}updateInstances(e){this.layerArr.forEach(t=>{this.instancesObj[t].forEach(t=>{t.update&&t.update(this,e)})})}paintInstances(){this.layerArr.forEach(e=>{this.instancesObj[e].forEach(e=>{e.paint&&e.paint(this)})})}togglePaused(){const e=this.utils.getCurrentTime();this.paused=!this.paused,this.paused?this.lastPausedAt=e:this.pausedTime+=e-this.lastPausedAt}addKeyUpListener(e,t){this.keyUpListeners[e]=t}addKeyDownListener(e,t){this.keyDownListeners[e]=t}addKeyPressListener(e,t){this.keyPressListeners[e]=t}findKeyListener(e,t){return"keyup"===t?this.keyUpListeners[e]:"keydown"===t?this.keyDownListeners[e]:this.keyPressListeners[e]}keyListener(e,t){let i;switch(e.keyCode){case 13:i="enter";break;case 32:i="space";break;case 37:i="leftArrow";break;case 39:i="rightArrow";break;case 38:i="upArrow";break;case 40:i="downArrow";break;default:i=e.keyCode}const n=this.findKeyListener(i,t);n&&n()}load(e,t){const i=setInterval(()=>{const n=this.assetsCount.image+this.assetsCount.audio,r=Object.keys(this.assetsObj.image).length+Object.keys(this.assetsObj.audio).length;t&&g(t)&&t({success:r,failed:this.assetsErrorCount,total:n}),this.assetsErrorQueue.length>0&&(this.assetsErrorQueue.forEach(e=>{const{retry:t,name:i,src:n,type:r}=e;t>=this.loadLimit?this.assetsErrorCount+=1:"image"===r?this.addImg(i,n,t):this.addAudio(i,n,t)}),this.assetsErrorQueue=[]),r===n&&(e&&g(e)?e():this.init(),clearInterval(i))},200)}init(){const e=this;d(t=>{this.animate.call(e,t)})}}class b{constructor(e={}){const{name:t,painter:i,action:n,trigger:r}=e;this.name=t,this.x=0,this.y=0,this.width=0,this.height=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.visible=!0,this.painter=i||null,this.action=n||null,this.trigger=r||null,this.ready=!1}paint(e){null!==this.painter&&this.visible&&this.painter(this,e)}update(e,t){null!==this.action&&this.action(this,e,t)}updateWidth(e){this.width=e,this.calWidth=e/2}updateHeight(e){this.height=e,this.calHeight=e/2}}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),c=i(1),l=i(4),u=i(5),h=i(6),d=i(7),g=i(8),f=a(i(0)),m=i(9),b=i(12);window.TowerGame=e=>{const{width:t,height:i,canvasId:n,soundOn:r}=e,o=new s.Engine({canvasId:n,highResolution:!0,width:t,height:i,soundOn:r}),a=e=>"./assets/"+e;o.addImg("background",a("background.png")),o.addImg("hook",a("hook.png")),o.addImg("blockRope",a("block-rope.png")),o.addImg("block",a("block.png")),o.addImg("block-perfect",a("block-perfect.png"));for(let e=1;e<=8;e+=1)o.addImg("c"+e,a(`c${e}.png`));for(let e=1;e<=7;e+=1)o.addImg("f"+e,a(`f${e}.png`));o.addImg("tutorial",a("tutorial.png")),o.addImg("tutorial-arrow",a("tutorial-arrow.png")),o.addImg("heart",a("heart.png")),o.addImg("score",a("score.png")),o.addAudio("drop-perfect",a("drop-perfect.mp3")),o.addAudio("drop",a("drop.mp3")),o.addAudio("game-over",a("game-over.mp3")),o.addAudio("rotate",a("rotate.mp3")),o.addAudio("bgm",a("bgm.mp3")),o.setVariable(f.blockWidth,.25*o.width),o.setVariable(f.blockHeight,.71*o.getVariable(f.blockWidth)),o.setVariable(f.cloudSize,.3*o.width),o.setVariable(f.ropeHeight,.4*o.height),o.setVariable(f.blockCount,0),o.setVariable(f.successCount,0),o.setVariable(f.failedCount,0),o.setVariable(f.gameScore,0),o.setVariable(f.hardMode,!1),o.setVariable(f.gameUserOption,e);for(let e=1;e<=4;e+=1){const t=new s.Instance({name:"cloud_"+e,action:h.cloudAction,painter:h.cloudPainter});t.index=e,t.count=5-e,o.addInstance(t)}const b=new s.Instance({name:"line",action:u.lineAction,painter:u.linePainter});o.addInstance(b);const p=new s.Instance({name:"hook",action:d.hookAction,painter:d.hookPainter});return o.addInstance(p),o.startAnimate=m.startAnimate,o.endAnimate=m.endAnimate,o.paintUnderInstance=l.background,o.addKeyDownListener("enter",()=>{o.debug&&o.togglePaused()}),o.touchStartListener=()=>{(0,c.touchEventHandler)(o)},o.playBgm=()=>{o.playAudio("bgm",!0)},o.pauseBgm=()=>{o.pauseAudio("bgm")},o.start=()=>{const e=new s.Instance({name:"tutorial",action:g.tutorialAction,painter:g.tutorialPainter});o.addInstance(e);const t=new s.Instance({name:"tutorial-arrow",action:g.tutorialAction,painter:g.tutorialPainter});o.addInstance(t),o.setTimeMovement(f.bgInitMovement,500),o.setTimeMovement(f.tutorialMovement,500),o.setVariable(f.gameStartNow,!0)},o},(0,b.initUI)()},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.background=t.backgroundLinearGradient=t.backgroundImg=void 0;const s=i(1),c=a(i(0));t.backgroundImg=e=>{const t=e.getImg("background"),i=t.width,n=t.height*e.width/i;let r=e.getVariable(c.bgImgOffset,e.height-n);r>e.height||(e.getTimeMovement(c.moveDownMovement,[[r,r+(0,s.getMoveDownValue)(e,{pixelsPerFrame:e=>e/2})]],e=>{r=e},{name:"background"}),e.getTimeMovement(c.bgInitMovement,[[r,r+n/4]],e=>{r=e}),e.setVariable(c.bgImgOffset,r),e.setVariable(c.lineInitialOffset,e.height-.394*n),e.ctx.drawImage(t,0,r,e.width,n))};const l=(e,t,i)=>{const n=t+1>=e.length?e.length-1:t,r=e[n],o=e[n+1>=e.length-1?n:n+1],a=e=>{const t=r[e],n=o[e];return Math.round(t+(n-t)*i)};return`rgb(${a(0)}, ${a(1)}, ${a(2)})`};t.backgroundLinearGradient=e=>{const t=e.ctx.createLinearGradient(0,0,0,e.height),i=[[200,255,150],[105,230,240],[90,190,240],[85,100,190],[55,20,35],[75,25,35],[25,0,10]],n=e.getVariable(c.bgLinearGradientOffset,0);(0,s.checkMoveDown)(e)&&e.setVariable(c.bgLinearGradientOffset,n+1.5*(0,s.getMoveDownValue)(e,null));const r=parseInt(String(n/e.height),10),o=n%e.height/e.height,a=l(i,r,o),u=l(i,r+1,o);t.addColorStop(0,u),t.addColorStop(1,a),e.ctx.fillStyle=t,e.ctx.beginPath(),e.ctx.rect(0,0,e.width,e.height),e.ctx.fill();const h=()=>{e.ctx.fillStyle="rgba(255, 255, 255, 0.7)",e.ctx.fillRect(0,0,e.width,e.height)};e.getTimeMovement(c.lightningMovement,[],()=>{},{before:h,after:h})};t.background=e=>{(0,t.backgroundLinearGradient)(e),(0,t.backgroundImg)(e)}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.linePainter=t.lineAction=void 0;const s=i(1),c=a(i(0));t.lineAction=(e,t,i)=>{const n=e;n.ready||(n.y=t.getVariable(c.lineInitialOffset),n.ready=!0,n.collisionX=t.width-t.getVariable(c.blockWidth)),t.getTimeMovement(c.moveDownMovement,[[e.y,e.y+(0,s.getMoveDownValue)(t,{pixelsPerFrame:e=>e/2})]],t=>{e.y=t},{name:"line"});const r=(0,s.getLandBlockVelocity)(t,i);e.x+=r,e.collisionX+=r};t.linePainter=(e,t)=>{const{ctx:i,debug:n}=t;n&&(i.save(),i.beginPath(),i.strokeStyle="red",i.moveTo(e.x,e.y),i.lineTo(e.collisionX,e.y),i.lineWidth=1,i.stroke(),i.restore())}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.cloudPainter=t.cloudAction=void 0;const s=i(1),c=a(i(0)),l=e=>{const{count:t}=e,i=e=>e[Math.floor(Math.random()*e.length)];e.imgName=i(t>6?["c4","c5","c6","c7","c8"]:["c1","c2","c3"])};t.cloudAction=(e,t)=>{if(!e.ready){e.ready=!0,l(e),e.width=t.getVariable(c.cloudSize),e.height=t.getVariable(c.cloudSize);const i=t.width,n=t.height,r=[{x:.1*i,y:.66*-n},{x:.65*i,y:.33*-n},{x:.1*i,y:0},{x:.65*i,y:.33*n}][e.index-1];e.x=t.utils.random(r.x,1.2*r.x),e.originX=e.x,e.ax=t.pixelsPerFrame(e.width*t.utils.random(.05,.08)*t.utils.randomPositiveNegative()),e.y=t.utils.random(r.y,1.2*r.y)}e.x+=e.ax,(e.x>=e.originX+e.width||e.x<=e.originX-e.width)&&(e.ax*=-1),(0,s.checkMoveDown)(t)&&(e.y+=1.2*(0,s.getMoveDownValue)(t,null)),e.y>=t.height&&(e.y=.66*-t.height,e.count+=4,l(e))};t.cloudPainter=(e,t)=>{const{ctx:i}=t,n=t.getImg(e.imgName);i.drawImage(n,e.x,e.y,e.width,e.height)}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.hookPainter=t.hookAction=void 0;const s=i(1),c=a(i(0));t.hookAction=(e,t,i)=>{const n=t.getVariable(c.ropeHeight);e.ready||(e.x=t.width/2,e.y=-1.5*n,e.ready=!0),t.getTimeMovement(c.hookUpMovement,[[e.y,e.y-n]],t=>{e.y=t},{after:()=>{e.y=-1.5*n}}),t.getTimeMovement(c.hookDownMovement,[[e.y,e.y+n]],t=>{e.y=t},{name:"hook"});const r=t.getVariable(c.initialAngle);e.angle=r*(0,s.getSwingBlockVelocity)(t,i),e.weightX=e.x+Math.sin(e.angle)*n,e.weightY=e.y+Math.cos(e.angle)*n};t.hookPainter=(e,t)=>{const{ctx:i}=t,n=t.getVariable(c.ropeHeight),r=.1*n,o=t.getImg("hook");i.save(),i.translate(e.x,e.y),i.rotate(2*Math.PI-e.angle),i.translate(-e.x,-e.y),t.ctx.drawImage(o,e.x-r/2,e.y,r,n+5),i.restore()}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.tutorialPainter=t.tutorialAction=void 0;const s=i(1),c=a(i(0));t.tutorialAction=(e,t,i)=>{const{width:n,height:r}=t,{name:o}=e;if(!e.ready){e.ready=!0;const t=.2*n;e.updateWidth(t),e.height=.46*t,e.x=n/2-e.width/2,e.y=.45*r,"tutorial"!==o&&(e.y+=1.2*e.height)}"tutorial"!==o&&(e.y+=Math.cos(i/200)*e.height*.01)};t.tutorialPainter=(e,t)=>{if(t.checkTimeMovement(c.tutorialMovement))return;if((0,s.getHookStatus)(t)!==c.hookNormal)return;const{ctx:i}=t,{name:n}=e,r=t.getImg(n);i.drawImage(r,e.x,e.y,e.width,e.height)}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.startAnimate=t.endAnimate=void 0;const s=i(2),c=i(10),l=i(1),u=i(11),h=a(i(0));t.endAnimate=e=>{if(!e.getVariable(h.gameStartNow))return;const t=e.getVariable(h.successCount,0),i=e.getVariable(h.failedCount),n=e.getVariable(h.gameScore,0),r=Number(t)>99?.1*e.width:0;(0,l.drawYellowString)(e,{string:"floor",size:.06*e.width,x:.24*e.width+r,y:.12*e.width,textAlign:"left",fontName:"Arial",fontWeight:"bold"}),(0,l.drawYellowString)(e,{string:String(t),size:.17*e.width,x:.22*e.width+r,y:.2*e.width,textAlign:"right"});const o=e.getImg("score"),a=o.width,s=o.height,c=.35*e.width,u=s*c/a;e.ctx.drawImage(o,.61*e.width,.038*e.width,c,u),(0,l.drawYellowString)(e,{string:String(n),size:.06*e.width,x:.9*e.width,y:.11*e.width,textAlign:"right"});const{ctx:d}=e,g=e.getImg("heart"),f=g.width,m=g.height,b=.08*e.width,p=m*b/f;for(let t=1;t<=3;t+=1)d.save(),t<=i&&(d.globalAlpha=.2),d.drawImage(g,.66*e.width+(t-1)*b,.16*e.width,b,p),d.restore()};t.startAnimate=e=>{if(!e.getVariable(h.gameStartNow))return;const t=e.getInstance("block_"+e.getVariable(h.blockCount));if(!t||[h.land,h.out].indexOf(t.status)>-1){if((0,l.checkMoveDown)(e)&&(0,l.getMoveDownValue)(e,null))return;if(e.checkTimeMovement(h.hookUpMovement))return;const t=(0,l.getAngleBase)(e),i=Math.PI*e.utils.random(t,t+5)*e.utils.randomPositiveNegative()/180;e.setVariable(h.blockCount,e.getVariable(h.blockCount)+1),e.setVariable(h.initialAngle,i),e.setTimeMovement(h.hookDownMovement,500);const n=new s.Instance({name:"block_"+e.getVariable(h.blockCount),action:c.blockAction,painter:c.blockPainter});e.addInstance(n)}switch(Number(e.getVariable(h.successCount,0))){case 2:(0,u.addFlight)(e,1,"leftToRight");break;case 6:(0,u.addFlight)(e,2,"rightToLeft");break;case 8:(0,u.addFlight)(e,3,"leftToRight");break;case 14:(0,u.addFlight)(e,4,"bottomToTop");break;case 18:(0,u.addFlight)(e,5,"bottomToTop");break;case 22:(0,u.addFlight)(e,6,"bottomToTop");break;case 25:(0,u.addFlight)(e,7,"rightTopToLeft")}}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.blockPainter=t.blockAction=void 0;const s=i(1),c=a(i(0)),l=(e,t)=>{e.status===c.rotateLeft?e.y-e.width>=t.height&&(e.visible=!1,e.status=c.out,(0,s.addFailedCount)(t)):e.y>=t.height&&(e.visible=!1,e.status=c.out,(0,s.addFailedCount)(t))};t.blockAction=(e,t,i)=>{const n=e,r=t.getVariable(c.ropeHeight);if(!n.visible)return;n.ready||(n.ready=!0,n.status=c.swing,e.updateWidth(t.getVariable(c.blockWidth)),e.updateHeight(t.getVariable(c.blockHeight)),e.x=t.width/2,e.y=-1.5*r);const o=t.getInstance("line");switch(n.status){case c.swing:t.getTimeMovement(c.hookDownMovement,[[e.y,e.y+r]],t=>{e.y=t},{name:"block"}),((e,t,i)=>{const n=t.getVariable(c.ropeHeight);if(e.status!==c.swing)return;const r=e,o=t.getVariable(c.initialAngle);r.angle=o*(0,s.getSwingBlockVelocity)(t,i),r.weightX=r.x+Math.sin(r.angle)*n,r.weightY=r.y+Math.cos(r.angle)*n})(e,t,i);break;case c.beforeDrop:n.x=e.weightX-e.calWidth,n.y=e.weightY+.3*e.height,n.rotate=0,n.vy=0,n.ay=t.pixelsPerFrame(3e-4*t.height),n.startDropTime=i,n.status=c.drop;break;case c.drop:const a=i-n.startDropTime;n.startDropTime=i,n.vy+=n.ay*a,n.y+=n.vy*a+.5*n.ay*a**2;const u=((e,t)=>e.y+e.height>=t.y?e.x<t.x-e.calWidth||e.x>t.collisionX+e.calWidth?1:e.x<t.x?2:e.x>t.collisionX?3:e.x>t.x+.8*e.calWidth&&e.x<t.x+1.2*e.calWidth?5:4:0)(e,o),h=o.y-e.height,d=e=>{e.originOutwardAngle=Math.atan(e.height/e.outwardOffset),e.originHypotenuse=Math.sqrt(e.height**2+e.outwardOffset**2),t.playAudio("rotate")};switch(u){case 1:l(e,t);break;case 2:n.status=c.rotateLeft,e.y=h,e.outwardOffset=o.x+e.calWidth-e.x,d(e);break;case 3:n.status=c.rotateRight,e.y=h,e.outwardOffset=o.collisionX+e.calWidth-e.x,d(e);break;case 4:case 5:n.status=c.land;const i=t.getVariable(c.successCount);(0,s.addSuccessCount)(t),t.setTimeMovement(c.moveDownMovement,500),10!==i&&15!==i||t.setTimeMovement(c.lightningMovement,150),e.y=h,o.y=h,o.x=n.x-n.calWidth,o.collisionX=o.x+n.width;const r=.3*n.width;(n.x>t.width-2*r||n.x<-r)&&t.setVariable(c.hardMode,!0),5===u?(e.perfect=!0,(0,s.addScore)(t,!0),t.playAudio("drop-perfect")):((0,s.addScore)(t,!1),t.playAudio("drop"))}break;case c.land:t.getTimeMovement(c.moveDownMovement,[[e.y,e.y+(0,s.getMoveDownValue)(t,{pixelsPerFrame:e=>e/2})]],i=>{e.visible&&(e.y=i,e.y>t.height&&(e.visible=!1))},{name:e.name}),e.x+=(0,s.getLandBlockVelocity)(t,i);break;case c.rotateLeft:case c.rotateRight:const g=n.status===c.rotateRight,f=t.pixelsPerFrame(4*Math.PI),m=g?1:-1;if(g?e.rotate>1.3:e.rotate<-1.3)e.rotate+=f/8*m,e.y+=t.pixelsPerFrame(.7*t.height),e.x+=t.pixelsPerFrame(.3*t.width)*m;else{let t=(e.calWidth-e.outwardOffset)/e.calWidth;t=t>.5?t:.5,e.rotate+=f*t*m;const i=e.originOutwardAngle+e.rotate,n=g?o.collisionX+e.calWidth:o.x+e.calWidth,r=o.y;e.x=n-Math.cos(i)*e.originHypotenuse,e.y=r-Math.sin(i)*e.originHypotenuse}l(e,t)}};const u=(e,t)=>{const{perfect:i}=e,n=t.getImg(i?"block-perfect":"block");t.ctx.drawImage(n,e.x,e.y,e.width,e.height)};t.blockPainter=(e,t)=>{const{status:i}=e;switch(i){case c.swing:((e,t)=>{const i=t.getImg("blockRope");t.ctx.drawImage(i,e.weightX-e.calWidth,e.weightY,e.width,1.3*e.height);e.weightX,e.calWidth})(e,t);break;case c.drop:case c.land:u(e,t);break;case c.rotateLeft:case c.rotateRight:((e,t)=>{const{ctx:i}=t;i.save(),i.translate(e.x,e.y),i.rotate(e.rotate),i.translate(-e.x,-e.y),u(e,t),i.restore()})(e,t)}}},function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),a=0;a<i.length;a++)"default"!==i[a]&&r(t,e,i[a]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.addFlight=t.flightPainter=t.flightAction=void 0;const s=a(i(0)),c=i(2);t.flightAction=(e,t)=>{const{visible:i,ready:n,type:r}=e;if(!i)return;const o=t.getVariable(s.cloudSize);if(!n){const i=((e,t)=>{const{width:i,height:n,utils:r}=e,{random:o}=r,a=e.getVariable(s.cloudSize);return{bottomToTop:{x:i*o(.3,.7),y:n,vx:0,vy:.7*e.pixelsPerFrame(n)*-1},leftToRight:{x:-1*a,y:n*o(.3,.6),vx:.4*e.pixelsPerFrame(i),vy:.1*e.pixelsPerFrame(n)*-1},rightToLeft:{x:i,y:n*o(.2,.5),vx:.4*e.pixelsPerFrame(i)*-1,vy:.1*e.pixelsPerFrame(n)},rightTopToLeft:{x:i,y:0,vx:.6*e.pixelsPerFrame(i)*-1,vy:.5*e.pixelsPerFrame(n)}}[t]})(t,r);e.ready=!0,e.width=o,e.height=o,e.x=i.x,e.y=i.y,e.vx=i.vx,e.vy=i.vy}e.x+=e.vx,e.y+=e.vy,(e.y+o<0||e.y>t.height||e.x+o<0||e.x>t.width)&&(e.visible=!1)};t.flightPainter=(e,t)=>{const{ctx:i}=t,n=t.getImg(e.imgName);i.drawImage(n,e.x,e.y,e.width,e.height)};t.addFlight=(e,i,n)=>{if(e.getVariable(s.flightCount)===i)return;const r=new c.Instance({name:"flight_"+i,action:t.flightAction,painter:t.flightPainter});r.imgName="f"+i,r.type=n,e.addInstance(r),e.setVariable(s.flightCount,i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initUI=function(){let e,t,i,n,r,o,a,s;const c=window.innerWidth;let l=window.innerHeight;l/c<1.5&&(l=Math.ceil(1.5*c));function u(){e&&i&&($("#canvas").show(),t=!0,setTimeout((function(){$(".loading").hide(),$(".landing").show()}),1e3))}function h(e){const{success:t,total:r,failed:o}=e;if(o>0&&!n)return n=!0,void alert("Network error... Please try again.");let a=Math.round(t/r*100);100!==a||i||(i=!0,u()),a=a>98?98:a;const s=a+"%";$(".loading .title").text(s),$(".loading .percent").css({width:s})}$(".content").css({height:l+"px",width:c+"px"}),$(".js-modal-content").css({width:c+"px"});const d={width:c,height:l,canvasId:"canvas",soundOn:!0,setGameScore:function(e){a=e},setGameSuccess:function(e){s=e},setGameFailed:function(e){$("#score").text(String(a)),e>=3&&($("#modal").show(),$("#over-modal").show(),$("#over-zero").show())}};function g(){o=window.TowerGame(d),o.load((function(){o.init(),setTimeout((function(){o.playBgm()}),1e3)}),h)}-1!==navigator.userAgent.toLowerCase().indexOf("micromessenger")?document.addEventListener("WeixinJSBridgeReady",g,!1):g();$("#start").on("click",(function(){r||(r=!0,setTimeout((function(){o.playBgm()}),200),$(".landing .action-1").addClass("slideTop"),$(".landing .action-2").addClass("slideBottom"),setTimeout((function(){$(".landing").hide()}),950),setTimeout(o.start,400))})),$(".js-reload").on("click",(function(){window.location.href=`${window.location.href}?s=${+new Date}`})),$(".js-invite").on("click",(function(){$(".wxShare").show()})),$(".wxShare").on("click",(function(){$(".wxShare").hide()})),window.addEventListener("load",(function(){e=!0,u()}),!1)}}]);